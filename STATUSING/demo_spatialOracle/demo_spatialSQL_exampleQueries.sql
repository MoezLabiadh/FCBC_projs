 -- Intersect Query 
SELECT b.PID, b.OWNER_TYPE, b.PARCEL_CLASS

FROM WHSE_TANTALIS.TA_CROWN_TENURES_SVW a, 
     WHSE_CADASTRE.PMBC_PARCEL_FABRIC_POLY_FA_SVW b

WHERE a.CROWN_LANDS_FILE = '1404764'
    AND a.DISPOSITION_TRANSACTION_SID = 937294
    AND a.INTRID_SID = 970611
    AND b.OWNER_TYPE = 'Private'
    AND SDO_RELATE (b.SHAPE, a.SHAPE,'mask=ANYINTERACT') = 'TRUE';
    
 
 
 
 -- Buffer Query 
SELECT b.PID, b.OWNER_TYPE, b.PARCEL_CLASS

FROM WHSE_TANTALIS.TA_CROWN_TENURES_SVW a, 
     WHSE_CADASTRE.PMBC_PARCEL_FABRIC_POLY_FA_SVW b

WHERE a.CROWN_LANDS_FILE = '1404764'
    AND a.DISPOSITION_TRANSACTION_SID = 937294
    AND a.INTRID_SID = 970611
    AND b.OWNER_TYPE = 'Private'
    AND SDO_WITHIN_DISTANCE (b.SHAPE, a.SHAPE,'distance = 500') = 'TRUE'
    AND SDO_GEOM.SDO_DISTANCE(a.SHAPE, b.SHAPE, 0.005) > 0;    
    
    
    
    
 -- Intersect Query with Overlap Area 
SELECT b.PID, b.OWNER_TYPE, b.PARCEL_CLASS, 
       ROUND((SDO_GEOM.SDO_AREA(SDO_GEOM.SDO_INTERSECTION(a.SHAPE,b.SHAPE, 0.005), 0.005, 'unit=HECTARE')), 2) OVERLAP_HECTARE

FROM WHSE_TANTALIS.TA_CROWN_TENURES_SVW a, 
     WHSE_CADASTRE.PMBC_PARCEL_FABRIC_POLY_FA_SVW b

WHERE a.CROWN_LANDS_FILE = '1404764'
    AND a.DISPOSITION_TRANSACTION_SID = 937294
    AND a.INTRID_SID = 970611
    AND b.OWNER_TYPE = 'Private'
    AND SDO_RELATE (b.SHAPE, a.SHAPE,'mask=ANYINTERACT') = 'TRUE';  
    
    
    
    
 -- Buffer Query with Distance
SELECT b.PID, b.OWNER_TYPE, b.PARCEL_CLASS,
       ROUND(SDO_GEOM.SDO_DISTANCE(a.SHAPE, b.SHAPE, 0.005),2) DISTANCE_METER

FROM WHSE_TANTALIS.TA_CROWN_TENURES_SVW a, 
     WHSE_CADASTRE.PMBC_PARCEL_FABRIC_POLY_FA_SVW b

WHERE a.CROWN_LANDS_FILE = '1404764'
    AND a.DISPOSITION_TRANSACTION_SID = 937294
    AND a.INTRID_SID = 970611
    AND b.OWNER_TYPE = 'Private'
    AND SDO_WITHIN_DISTANCE (b.SHAPE, a.SHAPE,'distance = 500') = 'TRUE'
    AND SDO_GEOM.SDO_DISTANCE(a.SHAPE, b.SHAPE, 0.005) > 0;  
    
    
    
-- Intersect Query: BCGW table against local AOI (SHP)    
SELECT b.PID, b.OWNER_TYPE, b.PARCEL_CLASS,
       ROUND((SDO_GEOM.SDO_AREA(SDO_GEOM.SDO_INTERSECTION(b.SHAPE, SDO_GEOMETRY(:wkt_aoi, 3005), 0.005), 0.005, 'unit=HECTARE')), 2) OVERLAP_HECTARE,

FROM WHSE_CADASTRE.PMBC_PARCEL_FABRIC_POLY_FA_SVW b

WHERE b.OWNER_TYPE = 'Private'
    
    AND SDO_RELATE (b.SHAPE, SDO_GEOMETRY(:wkt_aoi, 3005),'mask=ANYINTERACT') = 'TRUE';   
    
    
    
---WKT example
POLYGON ((1138116.5026434604078531 464753.6490426156669855, 1139328.1945873200893402 464770.7151263300329447, 1139346.9598328787833452 
          463438.3826914299279451, 1138135.2678890191018581 463421.3166077155619860, 1138116.5026434604078531 464753.6490426156669855))